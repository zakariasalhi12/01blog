<head>
    <link href="https://fonts.googleapis.com/css2?family=Material+Icons+Outlined&display=swap" rel="stylesheet">
</head>

<div class="post">

    <div class="post-header">
        <div [routerLink]="['/profile', post.authorId]">
            <img [src]="getFullFileUrl(post.avatar)" alt="avatar">
            <span>{{ post.author }}</span>
        </div>
        <span class="date">{{ timeAgo(post.createdAt) }}</span>
    </div>

    <div class="post-content" [routerLink]="['/post', post.id]">
        <h1>{{ post.title }}</h1>
        <p>{{ post.content }}</p>

        <div class="img-container" *ngIf="post.fileUrl">
            <img *ngIf="post.mediaType === 'image'" [src]="getFullFileUrl(post.fileUrl)" alt="post image">

            <video *ngIf="post.mediaType === 'video'" controls>
                <source [src]="getFullFileUrl(post.fileUrl)" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>
    </div>

    <div class="post-footer">
        <div [class.active]="post.likedByCurrentUser" (click)="likePost(post.id)">
            <mat-icon fontSet="material-icons-outlined">arrow_upward</mat-icon>
            <span>{{ post.likesCount }}</span>
        </div>
        <div [routerLink]="['/post', post.id]">
            <mat-icon fontSet="material-icons-outlined">comment</mat-icon>
            <span>{{ post.commentsCount }}</span>
        </div>
        <!-- Actions Menu Trigger -->
        <div class="post-actions" (click)="$event.stopPropagation()">
            <button class="icon-btn" (click)="toggleMenu()">
                <mat-icon>more_vert</mat-icon>
            </button>
            <div class="popup-menu" *ngIf="showMenu">
                <button class="menu-item" (click)="openEditModal()" *ngIf="post.owner">
                    <mat-icon>edit</mat-icon> Edit Post
                </button>
                <button class="menu-item delete" (click)="openReportModal()"
                    *ngIf="!post.owner && !post.reportedByCurrentUser">
                    <mat-icon>flag</mat-icon> Report
                </button>
                <button class="menu-item" (click)="undoReport()" *ngIf="!post.owner && post.reportedByCurrentUser">
                    <mat-icon>flag</mat-icon> Undo Report
                </button>
            </div>
        </div>
    </div>

</div>

<!-- Edit Modal -->
<div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <h2>Edit Post</h2>
        <input type="text" [(ngModel)]="editTitle" placeholder="Title" class="modal-input">
        <textarea [(ngModel)]="editContent" placeholder="Content" class="modal-textarea" rows="5"></textarea>
        <input type="file" (change)="onEditFileSelected($event)" accept="image/*,video/*" class="modal-file-input">
        <div *ngIf="editPreviewUrl" class="preview-container">
            <img *ngIf="editPreviewUrl.startsWith('data:image')" [src]="editPreviewUrl" alt="Preview"
                class="preview-image">
            <video *ngIf="editPreviewUrl.startsWith('data:video')" [src]="editPreviewUrl" controls
                class="preview-video"></video>
        </div>
        <div class="modal-actions">
            <button (click)="closeEditModal()" class="btn-cancel">Cancel</button>
            <button (click)="updatePost()" class="btn-save">Update</button>
        </div>
    </div>
</div>

<!-- Report Modal -->
<div class="modal-overlay" *ngIf="showReportModal" (click)="closeReportModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <h2>Report Post</h2>
        <textarea [(ngModel)]="reportReason" placeholder="Reason for reporting..." class="modal-textarea"
            rows="5"></textarea>
        <div class="modal-actions">
            <button (click)="closeReportModal()" class="btn-cancel">Cancel</button>
            <button (click)="reportPost()" class="btn-report">Report</button>
        </div>
    </div>
</div>