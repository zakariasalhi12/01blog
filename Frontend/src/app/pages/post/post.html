<app-main-header></app-main-header>

<h1 class="title"> Post </h1>

<section class="post" *ngIf="post() as profile">
    <div class="post-container">

        <div class="post-header">
            <div class="profile" , [routerLink]="['/profile' , post().authorId]" >
                <img [src]="getFullFileUrl(post().avatar)" alt="profile">
                <p>{{ post().author }}</p>
            </div>

            <p>{{ timeAgo(post().createdAt) }} </p>
        </div>
        <div class="post-content">
            <h1>{{ post().title }}</h1>
            <p>{{ post().content }}</p>

            <div class="img">
                <img *ngIf="post().mediaType === 'image'" [src]="getFullFileUrl(post().fileUrl)" alt="post image">

                <video *ngIf="post().mediaType === 'video'" controls>
                    <source [src]="getFullFileUrl(post().fileUrl)" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
        </div>

        <div class="post-footer">
            <div [class.active]="post().likedByCurrentUser" (click)="likePost(post().id)">
                <mat-icon fontSet="material-icons-outlined">arrow_upward</mat-icon>
                <span>{{ post().likesCount }}</span>
            </div>
        </div>
    </div>
</section>

<h1 class="title"> Comments</h1>

<div class="create-comment">
  <label for="comment">Comment content</label>
  <textarea id="comment" [(ngModel)]="commentContent" name="commentContent" rows="3" placeholder="Write your comment..."></textarea>
  <button (click)="submitComment()">Submit</button>
</div>

<section class="comments">
  <div class="comments-container" *ngFor="let comment of comments()">
    <div class="comment-header">
      <div>
        <img [src]="getFullFileUrl(comment.avatar)" alt="avatar">
        <h1>{{ comment.username }}</h1>
      </div>
      <p>{{ timeAgo(comment.createdAt) }}</p>
    </div>
    <div class="comment-content">
      <p>{{ comment.content }}</p>
    </div>
  </div>

  <div *ngIf="loadingComments"><p>Loading comments...</p></div>
  <div *ngIf="!loadingComments && !allCommentsLoaded">
    <button (click)="loadComments()">Load more comments</button>
  </div>
  <div *ngIf="allCommentsLoaded"><p>No more comments.</p></div>
</section>

