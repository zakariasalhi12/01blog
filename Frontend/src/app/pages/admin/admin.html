<app-main-header></app-main-header>

<div class="admin-dashboard">
  <div class="dashboard-header">
    <h1>Admin Dashboard</h1>
    <p class="subtitle">Manage users, reports, and content</p>
  </div>

  <div class="messages">
    <div class="error-message" *ngIf="error">
      {{ error }}
    </div>
    <div class="success-message" *ngIf="success">
      {{ success }}
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'users'"
      (click)="activeTab = 'users'">
      Users
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'reports'"
      (click)="activeTab = 'reports'">
      Reports
    </button>
  </div>

  <!-- Users Section -->
  <div class="users-section" *ngIf="activeTab === 'users'">
    <div class="section-header">
      <h2>Users Management</h2>
      <button class="refresh-btn" (click)="loadUsers()" [disabled]="loading">
        {{ loading ? 'Loading...' : 'Refresh' }}
      </button>
    </div>

    <div class="loading" *ngIf="loading && users.length === 0">
      Loading users...
    </div>

    <div class="users-table-container" *ngIf="!loading || users.length > 0">
      <table class="users-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Email</th>
            <th>Role</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users" [class.banned]="user.role === 'BANNED'">
            <td>{{ user.id }}</td>
            <td>{{ user.username }}</td>
            <td>{{ user.email }}</td>
            <td>
              <span class="role-badge" [ngClass]="getRoleBadgeClass(user.role)">
                {{ user.role }}
              </span>
            </td>
            <td class="actions-cell">
              <div class="action-buttons">
                <button 
                  class="btn btn-ban" 
                  (click)="banUser(user)"
                  [disabled]="user.role === 'BANNED'"
                  title="Ban user">
                  Ban
                </button>
                <button 
                  class="btn btn-admin" 
                  (click)="makeAdmin(user)"
                  [disabled]="user.role === 'ADMIN'"
                  title="Make admin">
                  Make Admin
                </button>
                <button 
                  class="btn btn-user" 
                  (click)="makeNormalUser(user)"
                  [disabled]="user.role === 'USER'"
                  title="Make normal user">
                  Make User
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="no-users" *ngIf="!loading && users.length === 0">
      No users found.
    </div>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="totalPages > 1 && !loading">
      <div class="pagination-info">
        Showing page {{ currentPage + 1 }} of {{ totalPages }} ({{ totalUsers }} total users)
      </div>
      <div class="pagination-controls">
        <button 
          class="pagination-btn" 
          (click)="previousPage()" 
          [disabled]="currentPage === 0">
          Previous
        </button>
        
        <div class="page-numbers">
          <button 
            *ngFor="let pageNum of getPageNumbers()"
            class="page-number"
            [class.active]="pageNum === currentPage"
            (click)="goToPage(pageNum)"
            [disabled]="pageNum === currentPage">
            {{ pageNum + 1 }}
          </button>
        </div>
        
        <button 
          class="pagination-btn" 
          (click)="nextPage()" 
          [disabled]="currentPage >= totalPages - 1">
          Next
        </button>
      </div>
    </div>
  </div>

  <!-- Reports Section -->
  <div class="reports-section" *ngIf="activeTab === 'reports'">
    <div class="section-header">
      <h2>Reports Management</h2>
      <button class="refresh-btn" (click)="loadReports()" [disabled]="loadingReports">
        {{ loadingReports ? 'Loading...' : 'Refresh' }}
      </button>
    </div>

    <div class="loading" *ngIf="loadingReports && reports.length === 0">
      Loading reports...
    </div>

    <div class="reports-table-container" *ngIf="!loadingReports || reports.length > 0">
      <table class="reports-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Reporter</th>
            <th>Type</th>
            <th>Target</th>
            <th>Reason</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let report of reports">
            <td>{{ report.id }}</td>
            <td>{{ report.reporterUsername }}</td>
            <td>
              <span class="type-badge" [class.post-badge]="report.postId" [class.user-badge]="report.reportedUserId">
                {{ report.postId ? 'Post' : 'User' }}
              </span>
            </td>
            <td>
              <span *ngIf="report.postId">
                Post: {{ report.postTitle || 'N/A' }}
              </span>
              <span *ngIf="report.reportedUserId">
                User: {{ report.reportedUsername || 'N/A' }}
              </span>
            </td>
            <td class="reason-cell">{{ report.reason }}</td>
            <td>{{ timeAgo(report.createdAt) }}</td>
            <td class="actions-cell">
              <button 
                class="btn btn-delete" 
                (click)="deleteReport(report.id)"
                title="Delete report">
                Delete
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="no-reports" *ngIf="!loadingReports && reports.length === 0">
      No reports found.
    </div>

    <!-- Reports Pagination -->
    <div class="pagination-container" *ngIf="reportsTotalPages > 1 && !loadingReports">
      <div class="pagination-info">
        Showing page {{ reportsCurrentPage + 1 }} of {{ reportsTotalPages }} ({{ reportsTotalReports }} total reports)
      </div>
      <div class="pagination-controls">
        <button 
          class="pagination-btn" 
          (click)="previousReportsPage()" 
          [disabled]="reportsCurrentPage === 0">
          Previous
        </button>
        
        <div class="page-numbers">
          <button 
            *ngFor="let pageNum of getReportsPageNumbers()"
            class="page-number"
            [class.active]="pageNum === reportsCurrentPage"
            (click)="goToReportsPage(pageNum)"
            [disabled]="pageNum === reportsCurrentPage">
            {{ pageNum + 1 }}
          </button>
        </div>
        
        <button 
          class="pagination-btn" 
          (click)="nextReportsPage()" 
          [disabled]="reportsCurrentPage >= reportsTotalPages - 1">
          Next
        </button>
      </div>
    </div>
  </div>
</div>
